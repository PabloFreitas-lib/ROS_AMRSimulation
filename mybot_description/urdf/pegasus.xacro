<?xml version="1.0" ?>
<robot name="pegasus" xmlns:xacro="http://ros.org/wiki/xacro">

  <xacro:include filename="$(find mybot_description)/urdf/pegasus.gazebo"/>


  <!-- Robot mechanical and motor parameters -->
  <xacro:property name="PI" value="3.1415926535897931"/>
  <xacro:property name="wheel_offset_x" value="0.479" />    <!-- x,y,z in base_footprint CS -->
  <xacro:property name="wheel_offset_y" value="0.0" />
  <xacro:property name="wheel_offset_z" value="0.110" />
  <xacro:property name="wheel_joint_damping" value="1.0" />
  <xacro:property name="wheel_joint_friction" value="1.0" />
  <xacro:property name="wheel_joint_effort_limit" value="1000.0" />
  <xacro:property name="wheel_joint_velocity_limit" value="2000.0" />
  <xacro:property name="wheel_mechanical_reduction" value="1.0" />
  <xacro:property name="motor_wheel_offset_z" value="0.110" />
  <xacro:property name="side_wheel_offset_y" value="0.267" />
  <xacro:property name="side_wheel_offset_z" value="0.070" />
  <xacro:property name="side_wheel_joint_damping" value="1.0" />
  <xacro:property name="side_wheel_joint_friction" value="1.0" />
  <!-- xacro:property name="side_wheel_offset_z" value="0.075" / -->

  <xacro:property name="steer_joint_damping" value="2.0" />
  <xacro:property name="steer_joint_friction" value="1.0" />
  <xacro:property name="steer_joint_effort_limit" value="100.0" />
  <xacro:property name="steer_joint_velocity_limit" value="100.0" />
  <xacro:property name="motor_wheel_mechanical_reduction" value="100.0" />

  <!-- pegasus -->
    <!-- Robot's part -->

  			<!-- Joint's -->

    <joint name="base_footprint_joint" type="fixed">
       <!-- NB While you would think this would make it go up, it is oddly reversed.
        This moves the joint to 0,0,0 where we want it for rviz, etc. -->
       <!-- origin xyz="0 0 -0.005" rpy="0 0 0" / -->
       <origin xyz="0 0 -0.005" rpy="0 0 0" />
       <parent link="base_footprint"/>
       <child link="base_link" />
    </joint>

  	  		<!-- Base footprint -->
  	<joint name="base_joint" type="fixed">
  		<origin xyz="0 0 0.0102" rpy="0 0 0" />
  		<parent link="base_footprint"/>
  		<child link="base_link" />
  	</joint>

  		  	<!-- Caster wheels -->

  		  	<!-- Left wheels -->
  	<joint name="left_axle_joint" type="fixed">
  		<origin xyz="0 0.171475 0.0178" rpy="0 0 0"/>
  		<parent link="base_link"/>
  		<child link="left_axle_link"/>
  		<axis xyz="0 1 0"/>
  	</joint>

  	<joint name="left_wheel_joint" type="fixed">
  		<origin xyz="0 0.01905 0" rpy="0 0 0"/>
  		<parent link="left_axle_link"/>
  		<child link="left_wheel_link"/>
  		<axis xyz="0 1 0"/>
  	</joint>

  		  	<!-- Right wheels -->

  	<joint name="right_axle_joint" type="fixed">
  		<origin xyz="0 -0.171475 0.0178" rpy="0 0 0"/>
  		<parent link="base_link"/>
  		<child link="right_axle_link"/>
  		<axis xyz="0 1 0"/>
  	</joint>

  	<joint name="right_wheel_joint" type="fixed">
  		<origin xyz="0 -0.01905 0" rpy="0 0 0"/>
  		<parent link="right_axle_link"/>
  		<child link="right_wheel_link"/>
  		<axis xyz="0 1 0"/>
  	</joint>

  		<!--Sensors -->


  	<joint name="laser_joint" type="fixed">
  		<axis xyz="0 1 0" />
  		<origin xyz=".15 0 .1" rpy="0 0 0"/>
  		<parent link="base_link"/>
  		<child link="laser_link"/>
  	</joint>


  		<!-- Link's -->

      <!-- BASE FOOTPRINT -->
      <!-- base_footprint is a fictitious link(frame) that is on the ground right below base_link origin,
                 navigation stack depends on this frame -->
      <link name="base_footprint">
          <visual>
              <origin xyz="0 0 0" rpy="0 0 0" />
              <geometry>
                 <box size="0.001 0.001 0.001" />
              </geometry>
          </visual>
      </link>

       		<!-- Chassis -->
  	<link name='base_link'>

  		<pose>0 0 0.1 0 0 0</pose>

  		<inertial>
  		<mass value="15.0"/>
  		<origin xyz="0.0 0 0.1" rpy=" 0 0 0"/>
  		<inertia
  		  ixx="0.1" ixy="0" ixz="0"
  		  iyy="0.1" iyz="0"
  		  izz="0.1"
  		/>
  		</inertial>

  		<collision>
  		<geometry>
  		<box size=".96 .665 .08"/>
  		</geometry>
  		</collision>

  		<visual>
  		<origin xyz="0 0 0" rpy=" 0 0 0"/>
  		<geometry>
  		<box size=".96 .665 .08"/>
  		</geometry>
  		</visual>

  		  	<!-- Caster wheels -->
  		<collision name='caster_collision'>
  		<origin xyz="-0.3 -0.25 0" rpy=" 0 0 0"/>
  			<geometry>
  				<sphere radius="0.065"/>
  			</geometry>
  			<surface>
  			<friction>
  				<ode>
  					<mu>0</mu>
  					<mu2>0</mu2>
  					<slip1>1.0</slip1>
  					<slip2>1.0</slip2>
  				</ode>
  			</friction>
  			</surface>
  		</collision>

  		<visual name='caster_visual'>
  		<origin xyz="-0.3 -0.25 0" rpy=" 0 0 0"/>
  			<geometry>
  				<sphere radius="0.065"/>
  			</geometry>
  		</visual>

  		<collision name='caster_front_collision'>
  		<origin xyz="-0.3 0.25 0" rpy=" 0 0 0"/>
  			<geometry>
  				<sphere radius="0.065"/>
  			</geometry>
  			<surface>
  			<friction>
  				<ode>
  					<mu>0</mu>
  					<mu2>0</mu2>
  					<slip1>1.0</slip1>
  					<slip2>1.0</slip2>
  				</ode>
  			</friction>
  			</surface>
  		</collision>

  		<visual name='caster_front_visual'>
  		<origin xyz="-0.3 0.25 0" rpy=" 0 0 0"/>
  			<geometry>
  				<sphere radius="0.065"/>
  			</geometry>
  		</visual>

  	</link>

  	  	<!-- Left wheels -->

  	<link name="left_axle_link">
  		<inertial>
        		<origin xyz="0 0 0" rpy="0 1.5707 1.5707"/>
  			<mass value="5" />
  			<inertia
  				ixx=".1" ixy="0.0" ixz="0.0"
  				iyy=".1" iyz="0.0"
  				izz=".1"/>
  		</inertial>

  		<visual>
        		<origin xyz="0.38 0.104 0" rpy="0 1.5707 1.5707"/>
  			<geometry>
  				<cylinder radius="0.077" length="0.05"/>
  			</geometry>
  			<material name ="light_grey" />
  		</visual>

  		<collision>
        		<origin xyz="0.38 0.104 0" rpy="0 1.5707 1.5707"/>
  			<geometry>
  				<cylinder radius="0.077" length="0.05"/>
  			</geometry>
  		</collision>
  	</link>

  	<link name="left_wheel_link">

  		<inertial>
  		<origin xyz="0 0 0" rpy="0 1.5707 1.5707"/>
  			<mass value="5" />
  			<inertia
  			ixx=".1" ixy="0.0" ixz="0.0"
  			iyy=".1" iyz="0.0"
  			izz=".1"/>
  		</inertial>

  		<visual>
  		<origin xyz="0.38 0.104 0" rpy="0 1.5707 1.5707"/>
  			<geometry>
  				<cylinder radius="0.077" length="0.05"/>
  			</geometry>
  			<material name ="black" />
  		</visual>

  		<collision>
  		<origin xyz="0.38 0.104 0" rpy="0 1.5707 1.5707"/>
  			<geometry>
  				<cylinder radius="0.077" length="0.05"/>
  			</geometry>
  		</collision>

  	</link>


  	  	<!-- Right wheels -->

  	<link name="right_axle_link">
  		<inertial>
        		<origin xyz="0 0 0" rpy="0 1.5707 1.5707"/>
  			<mass value="5" />
  			<inertia
  				ixx=".1" ixy="0.0" ixz="0.0"
  				iyy=".1" iyz="0.0"
  				izz=".1"/>
  		</inertial>

  		<visual>
        		<origin xyz="0.38 -0.104 0" rpy="0 1.5707 1.5707"/>
  			<geometry>
  				<cylinder radius="0.077" length="0.05"/>
  			</geometry>
  			<material name ="light_grey" />
  		</visual>

  		<collision>
        		<origin xyz="0.38 -0.104 0" rpy="0 1.5707 1.5707"/>
  			<geometry>
  				<cylinder radius="0.077" length="0.05"/>
  			</geometry>
  		</collision>
  	</link>

  	<link name="right_wheel_link">
  		<inertial>
        		<origin xyz="0 0 0" rpy="0 1.5707 1.5707"/>
  			<mass value="5" />
  			<inertia
  				ixx=".1" ixy="0.0" ixz="0.0"
  				iyy=".1" iyz="0.0"
  				izz=".1"/>
  		</inertial>

  		<visual>
        		<origin xyz="0.38 -0.104 0" rpy="0 1.5707 1.5707"/>
  			<geometry>
  				<cylinder radius="0.077" length="0.05"/>
  			</geometry>
  			<material name ="black" />
  		</visual>

  		<collision>
        		<origin xyz="0.38 -0.104 0" rpy="0 1.5707 1.5707"/>
  			<geometry>
  				<cylinder radius="0.077" length="0.05"/>
  			</geometry>
  		</collision>
  	</link>

  		<!-- Hokuyo Laser -->
  	<link name="laser_link">
  		<collision>
  			<origin xyz="0 0 0" rpy="0 0 0"/>
  			<geometry>
  				<box size="0.1 0.1 0.1"/>
  			</geometry>
  		</collision>

  		<visual>
  		<origin xyz="0 0 0.075" rpy="0 0 0"/>
  			<geometry>
  				<mesh filename="package://pegasus_description/meshes/hokuyo.dae"/>
  			</geometry>
  		</visual>

  	<inertial>
  	<mass value="1e-5" />
  	<origin xyz="0 0 0" rpy="0 0 0"/>
  	<inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6" />
  	</inertial>
  	</link>




    <link name="base_footprint"/>
    <!--
       Base link is set at the bottom of the base mould.
       This is done to be compatible with the way base link
       was configured for turtlebot 1. Refer to
       https://github.com/turtlebot/turtlebot/issues/40
       To put the base link at the more oft used wheel
       axis, set the z-distance from the base_footprint
       to 0.352.
      -->
    <joint name="base_joint" type="fixed">
      <origin xyz="0 0 0.0102" rpy="0 0 0" />
      <parent link="base_footprint"/>
      <child link="base_link" />
    </joint>

    <link name="base_link">
      <visual>
        <geometry>
          <!-- new mesh -->
          <mesh filename="package://pegasus_description/meshes/base_plate.dae" />
        </geometry>

<!--        <origin xyz="0.001 0 0.05199" rpy="0 0 ${PI/2}"/> -->
	 <origin xyz="0.001 0 -0.034" rpy="0 0 ${PI/2}"/>
      </visual>
      <collision>
        <geometry>
          <cylinder length="0.10938" radius="0.178"/>
        </geometry>
        <origin xyz="0.0 0 0.05949" rpy="0 0 0"/>
      </collision>
      <inertial>
        <!-- COM experimentally determined -->
        <origin xyz="0.01 0 0"/>
        <mass value="2.4"/> <!-- 2.4/2.6 kg for small/big battery pack -->
        <!-- Kobuki's inertia tensor is approximated by a cylinder with homogeneous mass distribution
             More details: http://en.wikipedia.org/wiki/List_of_moment_of_inertia_tensors
             m = 2.4 kg; h = 0.09 m; r = 0.175 m
             ixx = 1/12 * m * (3 * r^2 + h^2)
             iyy = 1/12 * m * (3 * r^2 + h^2)
             izz = 1/2 * m * r^2
          -->
        <inertia ixx="0.019995" ixy="0.0" ixz="0.0"
                 iyy="0.019995" iyz="0.0"
                 izz="0.03675" />
      </inertial>
    </link>





    <joint name="wheel_left_joint" type="continuous">
      <parent link="base_link"/>
      <child link="pegasus_wheel_left_link"/>
      <origin xyz="0 ${0.28/2} 0.026" rpy="${-PI/2} 0 0"/>
      <axis xyz="0 0 1"/>
    </joint>
    <link name="pegasus_wheel_left_link">
      <visual>
        <geometry>
          <mesh filename="package://pegasus_description/meshes/wheel.dae"/>
        </geometry>
        <origin xyz="0 0 0" rpy="0 0 0"/>
      </visual>
      <collision>
        <geometry>
          <cylinder length="0.0206" radius="0.0352"/>
        </geometry>
        <origin rpy="0 0 0" xyz="0 0 0"/>
      </collision>
      <inertial>
        <mass value="0.01" />
        <origin xyz="0 0 0" />
        <inertia ixx="0.001" ixy="0.0" ixz="0.0"
                 iyy="0.001" iyz="0.0"
                 izz="0.001" />
      </inertial>
    </link>

    <joint name="wheel_right_joint" type="continuous">
      <parent link="base_link"/>
      <child link="pegasus_wheel_right_link"/>
      <origin xyz="0.00 -${0.28/2} 0.026" rpy="${-PI/2} 0 0"/>
      <axis xyz="0 0 1"/>
    </joint>
    <link name="pegasus_wheel_right_link">
      <visual>
        <geometry>
          <mesh filename="package://pegasus_description/meshes/wheel.dae"/>
        </geometry>
        <origin xyz="0 0 0" rpy="0 0 0"/>
      </visual>
      <collision>
        <geometry>
          <cylinder length="0.0206" radius="0.0350"/>
        </geometry>
        <origin rpy="0 0 0" xyz="0 0 0"/>
      </collision>
      <inertial>
        <mass value="0.01" />
        <origin xyz="0 0 0" />
        <inertia ixx="0.001" ixy="0.0" ixz="0.0"
                 iyy="0.001" iyz="0.0"
                 izz="0.001" />
      </inertial>
    </link>
<!--
	  <link name="left_axle_link">
	    <inertial>
	      <origin xyz="0 0 0"/>
	      <mass value="0.01" />
	      <inertia ixx="0.001" ixy="0.0" ixz="0.0"
	        iyy="0.001" iyz="0.0" izz="0.001" />
	    </inertial>
	    <visual>
	      <origin xyz="0 0 0" rpy="0 1.5707 1.5707" />
	      <geometry>
            <cylinder radius="0.00635" length = "0.00635"/>
	      </geometry>
          <material name ="light_grey" />
	    </visual>
	    <collision>
	      <origin xyz="0 0 0" rpy="0 1.5707 1.5707" />
	      <geometry>
            <cylinder radius="0.00635" length = "0.00635"/>
	      </geometry>
	    </collision>
	  </link>
	  <joint name="left_axle_joint" type="fixed">
	    <origin xyz="0 0.171475 0.0178" rpy="0 0 0"/>
	    <parent link="base_link"/>
	    <child link="left_axle_link"/>
	    <axis xyz="0 1 0"/>
	  </joint>
	  <link name="right_axle_link">
	    <inertial>
	      <origin xyz="0 0 0"/>
	      <mass value="0.01" />
	      <inertia ixx="0.001" ixy="0.0" ixz="0.0"
	        iyy="0.001" iyz="0.0" izz="0.001" />
	    </inertial>
	    <visual>
	      <origin xyz="0 0 0" rpy="0 1.5707 1.5707" />
	      <geometry>
            <cylinder radius="0.00635" length = "0.00635"/>
	      </geometry>
          <material name ="light_grey" />
	    </visual>
	    <collision>
	      <origin xyz="0 0 0" rpy="0 1.5707 1.5707" />
	      <geometry>
            <cylinder radius="0.00635" length = "0.00635"/>
	      </geometry>
	    </collision>
	  </link>
	  <joint name="right_axle_joint" type="fixed">
	    <origin xyz="0 -0.171475 0.0178" rpy="0 0 0"/>
	    <parent link="base_link"/>
	    <child link="right_axle_link"/>
	    <axis xyz="0 1 0"/>
	  </joint>
	  <link name="left_wheel_link">
	    <inertial>
	      <origin xyz="0 0 0"/>
	      <mass value="0.01" />
	      <inertia ixx="0.001" ixy="0.0" ixz="0.0"
	        iyy="0.001" iyz="0.0" izz="0.001" />
	    </inertial>
	    <visual>
	      <origin xyz="0 0 0" rpy="0 1.5707 1.5707" />
	      <geometry>
            <cylinder radius="0.0762" length = "0.03175"/>
	      </geometry>
          <material name ="black" />
	    </visual>
	    <collision>
	      <origin xyz="0 0 0" rpy="0 1.5707 1.5707" />
	      <geometry>
            <cylinder radius="0.0762" length = "0.03175"/>
	      </geometry>
	    </collision>
	  </link>
        -->

<!--	  <joint name="left_wheel_joint" type="fixed">
	    <origin xyz="0 0.01905 0" rpy="0 0 0"/>
	    <parent link="left_axle_link"/>
	    <child link="left_wheel_link"/>
	    <axis xyz="0 1 0"/>
	  </joint>
	  <link name="right_wheel_link">
	    <inertial>
	      <origin xyz="0 0 0"/>
	      <mass value="0.01" />
	      <inertia ixx="0.001" ixy="0.0" ixz="0.0"
	        iyy="0.001" iyz="0.0" izz="0.001" />
	    </inertial>
	    <visual>
	      <origin xyz="0 0 0" rpy="0 1.5707 1.5707" />
	      <geometry>
            <cylinder radius="0.0762" length = "0.03175"/>
	      </geometry>
          <material name ="black" />
	    </visual>
	    <collision>
	      <origin xyz="0 0 0" rpy="0 1.5707 1.5707" />
	      <geometry>
            <cylinder radius="0.0762" length = "0.03175"/>
	      </geometry>
	    </collision>
	  </link>
	-->
        <!-- Fixed because we never rotate it anyway, it is just for show -->
        <!-- NOTE This may prevent gazebo from working with this model -->
<!--	  <joint name="right_wheel_joint" type="fixed">
	    <origin xyz="0 -0.01905 0" rpy="0 0 0"/>
	    <parent link="right_axle_link"/>
	    <child link="right_wheel_link"/>
	    <axis xyz="0 1 0"/>
	  </joint>
-->
    <joint name="caster_front_joint" type="fixed">
      <parent link="base_link"/>
      <child link="pegasus_caster_front_link"/>
      <origin xyz="0.115 0.0 0.007" rpy="${-PI/2} 0 0"/>
    </joint>
    <link name="pegasus_caster_front_link">
      <collision>
        <geometry>
          <cylinder length="0.0176" radius="0.017"/>
        </geometry>
        <origin rpy="0 0 0" xyz="0 0 0"/>
      </collision>
      <inertial>
        <mass value="0.01" />
        <origin xyz="0 0 0" />
        <inertia ixx="0.001" ixy="0.0" ixz="0.0"
                 iyy="0.001" iyz="0.0"
                 izz="0.001" />
      </inertial>
    </link>

    <joint name="pegasus_caster_back_joint" type="fixed">
      <parent link="base_link"/>
      <child link="pegasus_caster_back_link"/>
      <origin xyz="-0.135 0.0 0.009" rpy="${-PI/2} 0 0"/>
    </joint>
    <link name="pegasus_caster_back_link">
      <collision>
        <geometry>
          <cylinder length="0.0176" radius="0.017"/>
        </geometry>
        <origin rpy="0 0 0" xyz="0 0 0"/>
      </collision>
      <inertial>
        <mass value="0.01" />
        <origin xyz="0 0 0" />
        <inertia ixx="0.001" ixy="0.0" ixz="0.0"
                 iyy="0.001" iyz="0.0"
                 izz="0.001" />
      </inertial>
    </link>

    <!-- Kobuki's sensors -->
    <joint name="gyro_joint" type="fixed">
      <axis xyz="0 1 0"/>
      <origin xyz="0.056 0.062 0.0202" rpy="0 0 0"/>
      <parent link="base_link"/>
      <child link="gyro_link"/>
    </joint>
    <link name="gyro_link">
      <inertial>
        <mass value="0.001"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <inertia ixx="0.0001" ixy="0" ixz="0"
                 iyy="0.000001" iyz="0"
                 izz="0.0001"/>
      </inertial>
    </link>

    <joint name="cliff_sensor_left_joint" type="fixed">
      <origin xyz="0.08734 0.13601 0.0214" rpy="0 ${PI/2} 0" />
      <parent link="base_link"/>
      <child link="cliff_sensor_left_link" />
    </joint>
    <link name="cliff_sensor_left_link">
      <inertial>
        <mass value="0.0001" />
        <origin xyz="0 0 0" />
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0"
                 iyy="0.0001" iyz="0.0"
                 izz="0.0001" />
      </inertial>
    </link>

    <joint name="cliff_sensor_right_joint" type="fixed">
      <origin xyz="0.085 -0.13601 0.0214" rpy="0 ${PI/2} 0" />
      <parent link="base_link"/>
      <child link="cliff_sensor_right_link" />
    </joint>
    <link name="cliff_sensor_right_link">
      <inertial>
        <mass value="0.0001" />
        <origin xyz="0 0 0" />
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0"
                 iyy="0.0001" iyz="0.0"
                 izz="0.0001" />
      </inertial>
    </link>

    <joint name="cliff_sensor_front_joint" type="fixed">
      <origin xyz="0.156 0.00 0.0214" rpy="0 ${PI/2} 0" />
      <parent link="base_link"/>
      <child link="cliff_sensor_front_link" />
    </joint>
    <link name="cliff_sensor_front_link">
      <inertial>
        <mass value="0.0001" />
        <origin xyz="0 0 0" />
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0"
                 iyy="0.0001" iyz="0.0"
                 izz="0.0001" />
      </inertial>
    </link>


</robot>
